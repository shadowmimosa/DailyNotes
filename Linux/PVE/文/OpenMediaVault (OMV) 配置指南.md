# OpenMediaVault (OMV) 配置指南

## 一、系统简介

**OpenMediaVault（OMV）** 是一款老牌的、面向 NAS 的 Linux 发行版，具有以下特点：

- 基于 Debian 系统
- 开源免费，无版权限制
- 广泛兼容 x86-64 平台
- 提供网页端管理界面
- 开箱即用的 NAS 功能（磁盘管理、SMB、NFS 等）

---

## 二、安装准备

### 2.1 下载镜像

1. 访问 [OMV 官网](https://www.openmediavault.org/)
2. 点击「Download」→「Stable」下载最新稳定版
3. 文件名格式：`openmediavault_7.4.17-amd64.iso`（约 940MB）

### 2.2 制作启动盘（推荐使用 Ventoy）

**Ventoy 优势：**
- 支持多个 ISO 镜像共存
- 无需反复格式化 U 盘

**制作步骤：**
1. 下载 [Ventoy](https://ventoy.net/cn/download.html)
2. 按照[官方教程](https://ventoy.net/cn/doc_start.html)制作启动盘（⚠️ 会清除 U 盘数据）
3. 将 OMV 的 ISO 文件复制到 U 盘 `Ventoy` 分区根目录
4. 进入 BIOS 设置从 U 盘启动
5. 选择「以正常模式启动（Boot in normal mode）」
6. 选择「Install」开始安装

---

## 三、系统安装流程

### 3.1 基本设置

| 步骤 | 配置项 | 说明 |
|------|--------|------|
| 1 | 语言选择 | 选择「简体中文」 |
| 2 | 地理位置 | 选择「中国」 |
| 3 | 键盘映射 | 选择「汉语」 |

### 3.2 网络配置

**建议操作：**
- ✅ 提前用网线连接 NAS 与路由器
- ✅ 确保路由器支持 DHCP 自动分配 IP
- 选择要使用的网卡（通常格式为 `enp0sxx`）

> 💡 **提示：** 无网络连接也可安装，但需手动干预，选择「暂时不配置网络」

### 3.3 主机名与密码

- **主机名（hostname）**：NAS 在局域网显示的名称
- **root 密码**：设置强密码保证系统安全（⚠️ 务必牢记）

### 3.4 选择安装磁盘

⚠️ **特别注意：**
- OMV 会**完全清除**目标磁盘数据
- 不支持自定义分区
- **安装前务必拔出所有数据盘**
- 看清磁盘容量，避免误操作

**正确操作：**
1. 仅连接系统盘和启动 U 盘
2. 根据厂家、容量、型号选择正确的目标磁盘
3. 确认后开始分区和安装

### 3.5 软件包管理器

- **镜像站区域**：选择「中国」
- **推荐镜像源**：
  - 网易：`mirrors.163.com`
  - 清华 TUNA：`mirrors.tuna.tsinghua.edu.cn`
  - 中科大：`mirrors.ustc.edu.cn`
- **HTTP 代理**：不需要则留空

### 3.6 完成安装

1. 等待安装完成
2. **拔掉启动盘**
3. 选择「继续」重启
4. 等待 5 秒或直接回车进入 OMV

---

## 四、初始化配置

### 4.1 连接网络与插入数据盘

**准备工作：**
- ✅ 开机前插入数据盘（避免热插拔识别问题）
- ✅ 用网线将 NAS 接入局域网
- ✅ 确保路由器支持 DHCP

### 4.2 登录管理后台

1. 查看屏幕上显示的 IP 地址（如 `enp5s0` 对应的地址）
2. 在同一局域网的电脑浏览器中访问该 IP
3. 使用默认账户登录：
   - **用户名：** `admin`
   - **密码：** `openmediavault`

### 4.3 设置固定 IP 地址

**操作路径：** 网络 → 接口

1. 点击「加号」按钮 → 选择「以太网」
2. 配置参数：
   - **设备**：选择目标网卡（`enp0sxx` 为板载网卡）
   - **IPv4 方式**：设为「静态」
   - **IP 地址**：指定固定 IP
   - **子网掩码**：填写子网掩码
   - **网关地址**：填写网关
3. 高级设置：
   - **DNS 服务器**：如阿里 DNS `223.5.5.5`
4. 点击「保存」→ 点击黄色横幅的「✅」应用配置

> 💡 **提示：** 设置完成后可拔掉显示器，后续操作通过网页端完成

### 4.4 修改管理员密码

1. 点击右上角「用户」图标
2. 选择「更改密码」
3. 输入新密码（建议与 root 密码不同）

### 4.5 创建用户

**操作路径：** 用户 → 用户

1. 点击「带圆圈加号」→ 选择「添加」
2. 指定**用户名**和**密码**
3. 确认密码
4. 点击「保存」并提交更改

> 💡 **用途：** 用于限制特定共享文件夹的访问权限

---

## 五、配置文件系统

### 5.1 挂载已有数据的磁盘

**操作路径：** 存储器 → 文件系统

1. 点击「右三角（▶️）」按钮进入「挂载」界面
2. 配置参数：
   - **文件系统**：选择要挂载的分区（根据容量和文件系统判断）
   - **标签**：自定义名称（如「数据盘」）
   - **用量警告阈值**：按需设置
3. 点击「保存」→ 点击「✅」应用配置

### 5.2 擦除磁盘并创建文件系统（新磁盘）

**步骤一：擦除磁盘**
1. 在磁盘管理界面选中目标硬盘
2. 点击「橡皮擦」按钮
3. 确认清除（⚠️ 会删除整个磁盘数据）

**步骤二：创建文件系统**

**操作路径：** 存储器 → 文件系统

1. 点击「带圆圈加号」按钮
2. 选择文件系统类型：

| 文件系统 | 特点 | 适用场景 |
|----------|------|----------|
| **BTRFS** | 灵活、便利、容错率高 | 推荐首选 |
| **Ext4** | 成熟稳定 | 通用场景 |
| **XFS** | 高性能 | 大文件存储 |
| **F2FS** | SSD 优化 | 固态硬盘 |

3. 配置参数：
   - **介绍**：选择「Single」（单个磁盘，不创建阵列）
   - **设备**：选择目标磁盘
4. 确认后自动格式化并打开「挂载」界面

> ⚠️ **注意：** OMV 创建的文件系统没有分区表，Windows 无法直接识别

---

## 六、设置共享文件夹

### 6.1 共享文件夹的作用

- 映射文件系统上的文件夹
- 用于 SMB/CIFS、NFS 等文件共享协议
- 为 OMV 其他功能组件提供存储

### 6.2 添加共享文件夹

**操作路径：** 存储器 → 共享文件夹

1. 点击「带圆圈加号」按钮
2. 配置参数：
   - **名称**：在局域网显示的名称
   - **文件系统**：选择已挂载的文件系统
   - **相对路径**：指定共享的文件夹（`/` 表示根目录）
   - **权限**：保持默认（管理员可读写，用户可读写，其他只读）
3. 点击「保存」并提交更改

### 6.3 设置权限

**操作路径：** 选中共享文件夹 → 点击「权限」按钮

**权限类型：**
- `Read/Write`：读写
- `Read-only`：只读
- `No access`：禁止访问

**操作步骤：**
1. 为每个用户设置权限
2. 点击保存并提交更改

> 💡 **说明：** NTFS/exFAT 文件系统即使不设置权限也可读写

### 6.4 后续维护

- 可随时修改共享文件夹指向的文件系统
- 选中文件夹 → 点击「铅笔」按钮编辑

---

## 七、配置 SMB/CIFS 文件共享

### 7.1 启用 SMB/CIFS

**操作路径：** 服务 → SMB/CIFS → 设置

1. 勾选「已启动」复选框
2. 其他选项保持默认
3. 点击「确认」并提交更改

### 7.2 添加共享文件夹到 SMB

**操作路径：** 服务 → SMB/CIFS → 共享

1. 点击「带圆圈加号」按钮
2. 配置参数：
   - **共享文件夹**：选择要共享的文件夹
   - **公开**：设置可访问性
     - **「否」**：仅授权用户可见
     - **「允许访客」**：访客可见和访问
     - **「仅访客」**：所有访问均以访客身份
3. 可选配置：
   - **注释**：描述信息
   - **只读**：设为只读
   - **可浏览**：在网络邻居中可见
4. 点击「保存」并提交更改

### 7.3 测试 SMB 共享

**Windows 测试方法：**

1. 在资源管理器地址栏输入：`\\<主机名或IP>`（如 `\\192.168.2.3`）
2. 检查是否能看到共享文件夹列表
3. 测试访客访问（可访问性为「允许访客」的文件夹）
4. 测试授权访问（可访问性为「否」的文件夹，输入用户名密码）

---

## 八、常见问题

### Q1: NTFS 文件夹可读写，但 Ext4 不行？

**原因：**
- NTFS 通过 NTFS-3G 在 Linux 下权限较宽松
- Ext4 等 Linux 文件系统有完备的权限机制

**解决方案：**
- 为 Ext4 上的共享文件夹正确配置权限

### Q2: 为什么不使用磁盘阵列（RAID）？

#### 磁盘阵列的常见方案

| RAID 类型 | 特点 | 优势 |
|----------|------|------|
| RAID 0 | 条带化 | 大容量存储，提升读写效率 |
| RAID 1 | 镜像 | 1:1 镜像备份 |
| RAID 5 | 分布式奇偶校验 | 冗余备份，利于故障恢复 |
| RAID 10 | 镜像+条带 | 兼顾性能和冗余 |

#### 为什么选择不组建 RAID

**磁盘阵列的局限性：**

1. **灵活性受限**
   - 组建阵列后不能轻易更换硬盘
   - 阵列中的硬盘已成为一个整体
   - 单独拆下的硬盘无法读取数据（除非导出整个阵列）

2. **冗余 ≠ 备份**
   - RAID 5/10 提升的是「冗余性」，不是真正的备份
   - 磁盘损坏后需要重建阵列，耗时且有失败风险
   - 适用场景是企业级存储，需要技术储备和容灾能力

3. **迁移成本高**
   - 更换阵列模式（如 RAID 0 → RAID 5）需清除原有数据
   - 升级容量时受限于阵列最小磁盘容量

4. **个人使用场景不适配**
   - 磁盘阵列重在「冗余」而非「备份」
   - 依托企业级数据管理能力
   - 个人用户难以应对阵列重建等复杂操作

#### 单盘方案的优势

**采用单盘战士策略：**

✅ **灵活性**
- 每块硬盘独立工作，各有分工
- 存放不同类型的数据
- 可随时单独更换、升级硬盘

✅ **兼容性**
- 已有多块硬盘存放不同数据
- 通过 NAS 让多台设备访问
- 不受 RAID 的「绑定」限制

✅ **可维护性**
- 硬盘故障时只影响单块盘
- 可直接将硬盘取下在其他设备读取
- 升级硬盘时无需重建整个阵列

#### 数据安全保障

**3-2-1 备份原则：**

采用严格的备份策略才是数据安全的根本：

- **3** 份数据副本
  - 1 份主份（NAS 上）
  - 2 份备份（本地硬盘 + 云存储）

- **2** 种不同介质
  - NAS 主存储
  - 移动硬盘冷备份

- **1** 份异地存放
  - 加密上传到可靠的云存储（如阿里云盘）
  - 定期离线备份至移动硬盘并存放在别处

**具体实施方案：**

| 数据类型 | 主存储 | 备份 1 | 备份 2 |
|---------|--------|--------|--------|
| 重要文档 | NAS | 云存储（加密） | 移动硬盘（异地） |
| 照片视频 | NAS | 本地硬盘 | 云存储 |
| 工作文件 | NAS | 云同步盘 | 定期冷备份 |

> 💡 **核心理念：** 磁盘阵列不能代替备份！养成良好的备份习惯才是数据安全的王道。

![alt text](<assets/OpenMediaVault (OMV) 配置指南/1761030301205.png>)

---

## 九、配置流程总结

```
安装 OMV → 初始化配置 → 挂载文件系统 → 设置共享文件夹 → 配置权限 → 配置 SMB/CIFS → 测试访问
```

**三步走策略：**
1. 挂载数据盘的文件系统
2. 设置共享文件夹及其权限
3. 设置 SMB/CIFS 共享

---

## 十、关键注意事项

### ⚠️ 安装阶段
- 安装前拔出所有数据盘
- 看清磁盘容量避免误操作
- 牢记 root 密码

### ⚠️ 配置阶段
- OMV 不会自动挂载数据盘
- 共享文件夹需手动添加到 SMB
- Ext4 等 Linux 文件系统必须配置权限

### ✅ 最佳实践
- 使用固定 IP 地址
- 为不同用户设置不同权限
- 定期备份重要数据
- 采用 3-2-1 备份原则

---

## 十一、扩展功能

OMV 还支持更多高级特性：
- NFS 协议
- FTP 服务
- Docker Compose 容器
- 插件系统扩展

---

## 十二、常用命令

### 系统管理
```bash
# 安全关机
poweroff

# 以 root 身份登录
# 在登录提示符输入：root
# 然后输入密码（不会回显）
```

### 网卡命名规则
- `enp0sxx`：板载有线网卡
- `enx` 开头：独立安装的网卡

---

## 参考资料

- [OMV 官方网站](https://www.openmediavault.org/)
- [Ventoy 官方网站](https://ventoy.net/cn/)
- [SAMBA 项目](https://www.samba.org/)
- [原文：OpenMediaVault 配置指南 - 少数派](https://pwa.sspai.com/post/100313)

---

**文档版本：** 1.0  
**更新日期：** 2025-10-21  
**适用版本：** OpenMediaVault 7.x